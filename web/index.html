<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description" content="·ª®ng d·ª•ng K·ª≥ M√¥n ƒê·ªôn Gi√°p - Ph√¢n t√≠ch d·ª± ƒëo√°n chuy√™n nghi·ªáp">
    <meta name="theme-color" content="#2c3e50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <title>üîÆ K·ª≥ M√¥n ƒê·ªôn Gi√°p - V≈© Vi·ªát C∆∞·ªùng</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="/static/manifest.json">

    <!-- Styles -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/main.css">

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
</head>

<body class="bg-light">
    <!-- Login Screen -->
    <div id="login-screen" class="container mt-5">
        <div class="card shadow mx-auto" style="max-width: 400px;">
            <div class="card-header bg-dark text-white text-center">
                <h4>üîê X√ÅC TH·ª∞C TRUY C·∫¨P</h4>
            </div>
            <div class="card-body text-center">
                <p>Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ s·ª≠ d·ª•ng</p>
                <input type="password" id="password" class="form-control mb-3 text-center"
                    placeholder="Nh·∫≠p m·∫≠t kh·∫©u..." autocomplete="current-password">
                <button onclick="app.login()" class="btn btn-success w-100 py-2">
                    üîë M·ªû ·ª®NG D·ª§NG
                </button>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="main-app" class="d-none">
        <!-- Header -->
        <nav class="navbar navbar-dark bg-dark sticky-top shadow-sm">
            <div class="container-fluid">
                <span class="navbar-brand mb-0 h1">üîÆ K·ª≤ M√îN ƒê·ªòN GI√ÅP</span>

                <!-- Zoom Controls -->
                <div class="d-flex align-items-center gap-2">
                    <div class="btn-group btn-group-sm" role="group" aria-label="Zoom controls">
                        <button type="button" class="btn btn-outline-light" onclick="app.zoomOut()" title="Thu nh·ªè">
                            <span style="font-size: 1.2rem;">üîç‚àí</span>
                        </button>
                        <button type="button" class="btn btn-outline-light" onclick="app.resetZoom()" title="ƒê·∫∑t l·∫°i">
                            <span style="font-size: 1rem;">100%</span>
                        </button>
                        <button type="button" class="btn btn-outline-light" onclick="app.zoomIn()" title="Ph√≥ng to">
                            <span style="font-size: 1.2rem;">üîç+</span>
                        </button>
                    </div>

                    <div class="d-flex flex-column align-items-end ms-2">
                        <span class="text-warning small fw-bold">V≈© Vi·ªát C∆∞·ªùng</span>
                        <span id="current-time" class="text-white-50" style="font-size: 0.75rem;">--:--</span>
                    </div>
                </div>
            </div>
        </nav>

        <div class="container-fluid px-2 px-md-3 mt-3">
            <!-- Topic Selection & Search -->
            <div class="card mb-3 shadow-sm border-danger">
                <div class="card-header bg-danger text-white py-2">
                    <h6 class="mb-0">üéØ CH·ª¶ ƒê·ªÄ CH√çNH</h6>
                </div>
                <div class="card-body p-2">
                    <!-- Search Bar -->
                    <div class="input-group mb-2">
                        <span class="input-group-text">üîç</span>
                        <input type="text" id="topic-search" class="form-control" placeholder="T√¨m ki·∫øm ch·ªß ƒë·ªÅ...">
                        <button class="btn btn-outline-secondary" onclick="app.clearSearch()">‚úñ</button>
                    </div>

                    <!-- Topic Dropdown -->
                    <select id="topic-select" class="form-select fw-bold text-danger border-danger mb-2">
                        <option value="T·ªïng Qu√°t">T·ªïng Qu√°t</option>
                    </select>

                    <!-- NEW: L·ª•c Th√¢n Selection -->
                    <div class="row g-2 mb-2">
                        <div class="col-md-6">
                            <label class="form-label small mb-1">üéØ ƒê·ªëi T∆∞·ª£ng (L·ª•c Th√¢n):</label>
                            <select id="luc-than-select" class="form-select form-select-sm">
                                <option value="B·∫£n th√¢n">üßë B·∫£n th√¢n</option>
                                <option value="Anh ch·ªã em">üë®‚Äçüë©‚Äçüëß Anh ch·ªã em</option>
                                <option value="B·ªë m·∫π">üë¥üëµ B·ªë m·∫π</option>
                                <option value="Con c√°i">üë∂ Con c√°i</option>
                                <option value="Quan">ü§ù Ng∆∞·ªùi ngo√†i (Quan)</option>
                                <option value="T√†i">üí∞ Ng∆∞·ªùi ngo√†i (T√†i)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="row g-2">
                        <div class="col-3">
                            <button onclick="app.calculate()" class="btn btn-primary w-100 btn-sm">
                                üîÆ L·∫¨P B√ÄN
                            </button>
                        </div>
                        <div class="col-3">
                            <button onclick="app.reloadCurrentTime()" class="btn btn-success w-100 btn-sm">
                                üîÑ GI·ªú TH·ª∞C
                            </button>
                        </div>
                        <div class="col-3">
                            <button onclick="app.showAnalysis()" class="btn btn-info w-100 btn-sm">
                                üìä CHI TI·∫æT
                            </button>
                        </div>
                        <div class="col-3">
                            <button onclick="app.showComparison()" class="btn btn-warning w-100 btn-sm">
                                ‚öñÔ∏è SO S√ÅNH
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- NEW: Full Lunar Calendar Display -->
            <div class="card mb-3 shadow-sm border-info">
                <div class="card-header bg-info text-white py-2">
                    <h6 class="mb-0">üìÖ √ÇM L·ªäCH (CAN CHI)</h6>
                </div>
                <div class="card-body p-2">
                    <div id="lunar-calendar" class="text-center fw-bold text-danger">
                        ƒêang t√≠nh to√°n...
                    </div>
                    <div class="row mt-2">
                        <div class="col-6">
                            <small class="text-muted">Ti·∫øt Kh√≠:</small>
                            <span id="tiet-khi" class="fw-bold">--</span>
                        </div>
                        <div class="col-6">
                            <small class="text-muted">C·ª•c:</small>
                            <span id="cuc-display" class="fw-bold">--</span>
                            <small class="text-muted ms-2">(<span id="duong-am">--</span> ƒê·ªôn)</small>
                        </div>
                    </div>
                    <!-- NEW: Tr·ª±c Ph√π & Tr·ª±c S·ª≠ -->
                    <div class="row mt-2 pt-2 border-top">
                        <div class="col-6">
                            <small class="text-muted">Sao Tr·ª±c Ph√π:</small>
                            <span id="truc-phu-display" class="fw-bold text-primary">--</span>
                        </div>
                        <div class="col-6">
                            <small class="text-muted">C·ª≠a Tr·ª±c S·ª≠:</small>
                            <span id="truc-su-display" class="fw-bold text-success">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- NEW: D·ª•ng Th·∫ßn Panel (3 Methods) -->
            <div class="card mb-3 shadow-sm border-success">
                <div class="card-header bg-success text-white py-2">
                    <h6 class="mb-0">üéØ D·ª§NG TH·∫¶N (3 PH∆Ø∆†NG PH√ÅP)</h6>
                </div>
                <div class="card-body p-2">
                    <div id="dung-than-panel">
                        <div class="text-muted small">Ch·ªçn ch·ªß ƒë·ªÅ ƒë·ªÉ xem D·ª•ng Th·∫ßn...</div>
                    </div>
                </div>
            </div>

            <!-- NEW: Palace Navigation -->
            <div class="card mb-3 shadow-sm border-secondary">
                <div class="card-body p-2">
                    <div class="row g-2">
                        <div class="col-4">
                            <button onclick="app.navigatePalace(-1)" class="btn btn-outline-secondary w-100 btn-sm">
                                ‚óÄ Cung Tr∆∞·ªõc
                            </button>
                        </div>
                        <div class="col-4 text-center">
                            <span class="badge bg-secondary" id="current-palace-indicator">Cung 5</span>
                        </div>
                        <div class="col-4">
                            <button onclick="app.navigatePalace(1)" class="btn btn-outline-secondary w-100 btn-sm">
                                Cung Sau ‚ñ∂
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chart Info Panel -->
            <div class="card mb-3 shadow-sm border-primary">
                <div class="card-header bg-primary text-white py-2">
                    <h6 class="mb-0">üìä TH√îNG TIN B√ÄN CUNG</h6>
                </div>
                <div class="card-body p-2">
                    <div class="row g-2 small">
                        <div class="col-6 col-md-4">
                            <strong>C·ª•c:</strong> <span id="info-ju" class="text-primary">--</span>
                        </div>
                        <div class="col-6 col-md-4">
                            <strong>Ti·∫øt Kh√≠:</strong> <span id="info-solar" class="text-success">--</span>
                        </div>
                        <div class="col-6 col-md-4">
                            <strong>Lo·∫°i:</strong> <span id="info-type" class="text-info">--</span>
                        </div>
                        <div class="col-6 col-md-4">
                            <strong>Tr·ª±c Ph√π:</strong> <span id="info-zhifu" class="text-warning">--</span>
                        </div>
                        <div class="col-6 col-md-4">
                            <strong>Tr·ª±c S·ª≠:</strong> <span id="info-zhishi" class="text-warning">--</span>
                        </div>
                        <div class="col-6 col-md-4">
                            <strong>ƒê·ªãa Chi Gi·ªù:</strong> <span id="info-branch" class="text-danger">--</span>
                        </div>
                        <div class="col-12">
                            <strong>üåô √Çm L·ªãch:</strong> <span id="info-lunar" class="text-muted">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- D·ª•ng Th·∫ßn Quick View -->
            <div class="card mb-3 shadow-sm border-success" id="dung-than-panel">
                <div class="card-header bg-success text-white py-2 d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">üéØ D·ª§NG TH·∫¶N (3 PH∆Ø∆†NG PH√ÅP)</h6>
                    <button class="btn btn-sm btn-light" onclick="app.toggleDungThan()">
                        <span id="dung-than-toggle">‚ñº</span>
                    </button>
                </div>
                <div class="card-body p-2" id="dung-than-content">
                    <div class="small text-muted">Ch·ªçn ch·ªß ƒë·ªÅ ƒë·ªÉ xem D·ª•ng Th·∫ßn...</div>
                </div>
            </div>

            <!-- Palace Navigation -->
            <div class="card mb-3 shadow-sm">
                <div class="card-body p-2">
                    <div class="d-flex justify-content-between align-items-center">
                        <button class="btn btn-outline-primary btn-sm" onclick="app.navigatePalace(-1)">
                            ‚óÄ Cung Tr∆∞·ªõc
                        </button>
                        <span class="fw-bold text-primary" id="current-palace-info">Cung 5</span>
                        <button class="btn btn-outline-primary btn-sm" onclick="app.navigatePalace(1)">
                            Cung Sau ‚ñ∂
                        </button>
                    </div>
                </div>
            </div>

            <!-- 3 Method Tabs - PROMINENT STYLE -->
            <div class="card mb-3 shadow-lg border-0">
                <div class="card-body p-3" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <ul class="nav nav-pills nav-fill mb-3" id="method-tabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active fw-bold py-3" id="qimen-tab" data-bs-toggle="tab"
                                data-bs-target="#qimen" type="button" role="tab"
                                style="font-size: 1.1rem; border-radius: 10px;">
                                üîÆ B·∫¢NG K·ª≤ M√îN
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link fw-bold py-3" id="maihoa-tab" data-bs-toggle="tab"
                                data-bs-target="#maihoa" type="button" role="tab"
                                style="font-size: 1.1rem; border-radius: 10px;">
                                üìñ MAI HOA 64 QU·∫∫
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link fw-bold py-3" id="luchao-tab" data-bs-toggle="tab"
                                data-bs-target="#luchao" type="button" role="tab"
                                style="font-size: 1.1rem; border-radius: 10px;">
                                ‚òØÔ∏è L·ª§C H√ÄO KINH D·ªäCH
                            </button>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Tab Content -->
            <div class="tab-content" id="method-tab-content">
                <!-- Qi Men Grid -->
                <div class="tab-pane fade show active" id="qimen">
                    <div id="qimen-grid" class="qmdg-grid mb-3">
                        <!-- 9 Palaces will be rendered here -->
                    </div>

                    <!-- Legend -->
                    <div class="card shadow-sm">
                        <div class="card-body p-2">
                            <div class="d-flex justify-content-around flex-wrap small">
                                <span>üíÄ Kh√¥ng Vong</span>
                                <span>üêé D·ªãch M√£</span>
                                <span class="text-success">‚úÖ C√°t</span>
                                <span class="text-danger">‚ùå Hung</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mai Hoa Tab -->
                <div class="tab-pane fade" id="maihoa">
                    <div id="maihoa-content" class="bg-white p-3 rounded shadow-sm">
                        <div class="text-center text-muted">ƒêang t·∫£i...</div>
                    </div>
                </div>

                <!-- L·ª•c H√†o Tab -->
                <div class="tab-pane fade" id="luchao">
                    <div id="luchao-content" class="bg-white p-3 rounded shadow-sm">
                        <div class="text-center text-muted">ƒêang t·∫£i...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Analysis Modal -->
    <div class="modal fade" id="analysisModal" tabindex="-1">
        <div class="modal-dialog modal-fullscreen-sm-down modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">üìä PH√ÇN T√çCH T·ªîNG H·ª¢P</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="analysis-body">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">ƒêang ph√¢n t√≠ch...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Palace Detail Modal -->
    <div class="modal fade" id="palaceModal" tabindex="-1">
        <div class="modal-dialog modal-fullscreen-sm-down modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="palace-modal-title">Chi Ti·∫øt Cung</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="palace-body">
                    <!-- Palace details will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: Comparison Modal -->
    <div class="modal fade" id="comparisonModal" tabindex="-1">
        <div class="modal-dialog modal-fullscreen-sm-down modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title">‚öñÔ∏è SO S√ÅNH 2 CUNG CHI TI·∫æT</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Selection -->
                    <div class="row mb-3">
                        <div class="col-md-5">
                            <label class="form-label fw-bold">Cung Ch·ªß (Cung 1):</label>
                            <select id="compare-palace1" class="form-select">
                                <option value="1">1 - Kh·∫£m</option>
                                <option value="2">2 - Kh√¥n</option>
                                <option value="3">3 - Ch·∫•n</option>
                                <option value="4">4 - T·ªën</option>
                                <option value="5" selected>5 - Trung Cung</option>
                                <option value="6">6 - C√†n</option>
                                <option value="7">7 - ƒêo√†i</option>
                                <option value="8">8 - C·∫•n</option>
                                <option value="9">9 - Ly</option>
                            </select>
                        </div>
                        <div class="col-md-2 text-center d-flex align-items-end justify-content-center">
                            <button onclick="app.performComparison()" class="btn btn-warning w-100">
                                ‚öñÔ∏è SO S√ÅNH
                            </button>
                        </div>
                        <div class="col-md-5">
                            <label class="form-label fw-bold">Cung Kh√°ch (Cung 2):</label>
                            <select id="compare-palace2" class="form-select">
                                <option value="1" selected>1 - Kh·∫£m</option>
                                <option value="2">2 - Kh√¥n</option>
                                <option value="3">3 - Ch·∫•n</option>
                                <option value="4">4 - T·ªën</option>
                                <option value="5">5 - Trung Cung</option>
                                <option value="6">6 - C√†n</option>
                                <option value="7">7 - ƒêo√†i</option>
                                <option value="8">8 - C·∫•n</option>
                                <option value="9">9 - Ly</option>
                            </select>
                        </div>
                    </div>

                    <!-- Comparison Result -->
                    <div id="comparison-result">
                        <div class="text-center text-muted">
                            Ch·ªçn 2 cung v√† nh·∫•n "So S√°nh" ƒë·ªÉ xem k·∫øt qu·∫£
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="d-none">
        <div class="spinner-border text-light" role="status">
            <span class="visually-hidden">ƒêang t·∫£i...</span>
        </div>
        <p class="text-light mt-3">ƒêang x·ª≠ l√Ω...</p>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/app.js"></script>
</body>

</html>
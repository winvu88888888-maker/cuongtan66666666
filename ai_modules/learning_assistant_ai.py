"""
LEARNING ASSISTANT AI - Tr·ª£ L√Ω H·ªçc QMDG
H∆∞·ªõng d·∫´n v√† d·∫°y h·ªçc K·ª≥ M√¥n ƒê·ªôn Gi√°p cho ng∆∞·ªùi m·ªõi
"""


# B√†i h·ªçc c∆° b·∫£n
LESSONS = {
    "basic": {
        "1": {
            "title": "Gi·ªõi thi·ªáu K·ª≥ M√¥n ƒê·ªôn Gi√°p",
            "content": """
## B√†i 1: K·ª≥ M√¥n ƒê·ªôn Gi√°p l√† g√¨?

**K·ª≥ M√¥n ƒê·ªôn Gi√°p** (Â•áÈñÄÈÅÅÁî≤) l√† m·ªôt trong 3 ƒë·∫°i h·ªçc thu·∫≠t s·ªë c·ªßa Trung Hoa c·ªï ƒë·∫°i, c√πng v·ªõi Th√°i ·∫§t v√† L·ª•c Nh√¢m.

### C·∫•u tr√∫c c∆° b·∫£n:
- **C·ª≠u Cung B√°t Qu√°i**: 9 cung (1-9), 8 qu√°i
- **B√°t M√¥n**: 8 c·ª≠a (Khai, H∆∞u, Sinh, Th∆∞∆°ng, ƒê·ªó, C·∫£nh, T·ª≠, Kinh)
- **C·ª≠u Tinh**: 9 sao (Thi√™n B·ªìng, Thi√™n Nhu·∫ø, Thi√™n Xung, Thi√™n Ph·ª•, Thi√™n C·∫ßm, Thi√™n T√¢m, Thi√™n Tr·ª•, Thi√™n Nh·∫≠m, Thi√™n Anh)
- **B√°t Th·∫ßn**: 8 th·∫ßn (Tr·ª±c Ph√π, ƒê·∫±ng X√†, Th√°i √Çm, L·ª•c H·ª£p, C√¢u Tr·∫ßn, Chu T∆∞·ªõc, C·ª≠u ƒê·ªãa, C·ª≠u Thi√™n)

### ·ª®ng d·ª•ng:
- Xem th·ªùi ƒëi·ªÉm t·ªët/x·∫•u
- D·ª± ƒëo√°n s·ª± vi·ªác
- Ch·ªçn h∆∞·ªõng, ph∆∞∆°ng v·ªã
- M∆∞u s·ª±, chi·∫øn l∆∞·ª£c
""",
            "quiz": [
                {"q": "QMDG c√≥ bao nhi√™u M√¥n?", "a": "8", "options": ["6", "8", "9", "10"]},
                {"q": "QMDG c√≥ bao nhi√™u Sao?", "a": "9", "options": ["7", "8", "9", "10"]}
            ]
        },
        "2": {
            "title": "B√°t M√¥n (8 C·ª≠a)",
            "content": """
## B√†i 2: B√°t M√¥n - 8 C·ª≠a

### M√¥n C√°t (T·ªët):
1. **Khai M√¥n** (ÈñãÈñÄ) - C·ª≠a M·ªü: T·ªët cho m·ªçi vi·ªác, ƒë·∫∑c bi·ªát kh·ªüi s·ª±
2. **H∆∞u M√¥n** (‰ºëÈñÄ) - C·ª≠a Ngh·ªâ: T·ªët cho ngh·ªâ ng∆°i, y√™n ·ªïn
3. **Sinh M√¥n** (ÁîüÈñÄ) - C·ª≠a Sinh: T·ªët cho c·∫ßu t√†i, sinh s·∫£n

### M√¥n Hung (X·∫•u):
4. **Th∆∞∆°ng M√¥n** (ÂÇ∑ÈñÄ) - C·ª≠a Th∆∞∆°ng: X·∫•u, tranh ch·∫•p, t·ªïn th∆∞∆°ng
5. **ƒê·ªó M√¥n** (ÊùúÈñÄ) - C·ª≠a ƒê·ªó: B·∫ø t·∫Øc, ·∫©n n√°u
6. **C·∫£nh M√¥n** (ÊôØÈñÄ) - C·ª≠a C·∫£nh: H∆∞ ·∫£o, kh√¥ng th·ª±c

### M√¥n ƒê·∫°i Hung:
7. **T·ª≠ M√¥n** (Ê≠ªÈñÄ) - C·ª≠a T·ª≠: C·ª±c x·∫•u, b·∫ø t·∫Øc
8. **Kinh M√¥n** (È©öÈñÄ) - C·ª≠a Kinh: Kinh s·ª£, b·∫•t an
""",
            "quiz": [
                {"q": "M√¥n n√†o t·ªët nh·∫•t cho vi·ªác c·∫ßu t√†i?", "a": "Sinh M√¥n", "options": ["Khai M√¥n", "Sinh M√¥n", "H∆∞u M√¥n", "C·∫£nh M√¥n"]},
                {"q": "M√¥n n√†o x·∫•u nh·∫•t?", "a": "T·ª≠ M√¥n", "options": ["Th∆∞∆°ng M√¥n", "ƒê·ªó M√¥n", "T·ª≠ M√¥n", "Kinh M√¥n"]}
            ]
        },
        "3": {
            "title": "C·ª≠u Tinh (9 Sao)",
            "content": """
## B√†i 3: C·ª≠u Tinh - 9 Sao

### Sao C√°t (T·ªët):
1. **Thi√™n T√¢m** (Â§©ÂøÉ): Sao Y d∆∞·ª£c, ch·ªØa b·ªánh, gi√∫p ƒë·ª°
2. **Thi√™n Ph·ª•** (Â§©Ëºî): Sao VƒÉn x∆∞∆°ng, h·ªçc h√†nh, thi c·ª≠
3. **Thi√™n Nh·∫≠m** (Â§©‰ªª): Sao T√†i l·ªôc, c·∫ßu t√†i, kinh doanh
4. **Thi√™n C·∫ßm** (Â§©Á¶Ω): Sao Trung t√¢m, ·ªïn ƒë·ªãnh

### Sao Hung (X·∫•u):
5. **Thi√™n B·ªìng** (Â§©Ëì¨): Sao Tr·ªôm c∆∞·ªõp, b√≠ m·∫≠t, ng·∫ßm
6. **Thi√™n Nhu·∫ø** (Â§©ËäÆ): Sao B·ªánh t·∫≠t, ·ªëm ƒëau
7. **Thi√™n Tr·ª•** (Â§©Êü±): Sao Ph√° ho·∫°i, tranh c√£i
8. **Thi√™n Anh** (Â§©Ëã±): Sao H·ªèa tai, n√≥ng n·∫£y

### Sao B√¨nh:
9. **Thi√™n Xung** (Â§©Ê≤ñ): Sao Xung ƒë·ªôt, ƒëi xa
""",
            "quiz": [
                {"q": "Sao n√†o t·ªët cho vi·ªác ch·ªØa b·ªánh?", "a": "Thi√™n T√¢m", "options": ["Thi√™n Ph·ª•", "Thi√™n T√¢m", "Thi√™n Nh·∫≠m", "Thi√™n C·∫ßm"]},
                {"q": "Sao n√†o li√™n quan ƒë·∫øn b·ªánh t·∫≠t?", "a": "Thi√™n Nhu·∫ø", "options": ["Thi√™n B·ªìng", "Thi√™n Nhu·∫ø", "Thi√™n Tr·ª•", "Thi√™n Anh"]}
            ]
        }
    },
    "intermediate": {
        "1": {
            "title": "D·ª•ng Th·∫ßn - X√°c ƒë·ªãnh m·ª•c ti√™u",
            "content": """
## D·ª•ng Th·∫ßn trong QMDG

**D·ª•ng Th·∫ßn** l√† y·∫øu t·ªë ƒë·∫°i di·ªán cho m·ª•c ti√™u b·∫°n ƒëang h·ªèi.

### D·ª•ng Th·∫ßn ph·ªï bi·∫øn:
| Ch·ªß ƒë·ªÅ | D·ª•ng Th·∫ßn | V·ªã tr√≠ |
|--------|-----------|--------|
| Ti·ªÅn b·∫°c, t√†i ch√≠nh | Sinh M√¥n | Cung c√≥ Sinh M√¥n |
| C√¥ng vi·ªác, s·ª± nghi·ªáp | Khai M√¥n | Cung c√≥ Khai M√¥n |
| S·ª©c kh·ªèe, b·ªánh t·∫≠t | Thi√™n T√¢m | Cung c√≥ Thi√™n T√¢m |
| T√¨nh c·∫£m, h√¥n nh√¢n | L·ª•c H·ª£p | Cung c√≥ L·ª•c H·ª£p |
| Di chuy·ªÉn, xu·∫•t h√†nh | M√£ Tinh | Cung c√≥ M√£ Tinh |

### Nguy√™n t·∫Øc:
1. X√°c ƒë·ªãnh D·ª•ng Th·∫ßn theo ch·ªß ƒë·ªÅ
2. T√¨m cung ch·ª©a D·ª•ng Th·∫ßn
3. Ph√¢n t√≠ch quan h·ªá v·ªõi cung B·∫£n Th√¢n (Can Ng√†y)
""",
            "quiz": []
        }
    },
    "advanced": {
        "1": {
            "title": "Lu·∫≠n gi·∫£i t·ªïng h·ª£p",
            "content": """
## Ph∆∞∆°ng ph√°p lu·∫≠n gi·∫£i t·ªïng h·ª£p

### B∆∞·ªõc 1: X√°c ƒë·ªãnh D·ª•ng Th·∫ßn
- D·ª±a tr√™n ch·ªß ƒë·ªÅ c√¢u h·ªèi

### B∆∞·ªõc 2: Ph√¢n t√≠ch cung D·ª•ng Th·∫ßn
- Sao, M√¥n, Th·∫ßn t·∫°i cung
- Can Thi√™n B√†n, Can ƒê·ªãa B√†n
- Kh√¥ng Vong, D·ªãch M√£

### B∆∞·ªõc 3: Ph√¢n t√≠ch quan h·ªá
- D·ª•ng Th·∫ßn sinh/kh·∫Øc B·∫£n Th√¢n?
- C√≥ Kh√¥ng Vong kh√¥ng?
- C√≥ D·ªãch M√£ kh√¥ng?

### B∆∞·ªõc 4: K·∫øt lu·∫≠n
- T·ªïng h·ª£p ƒëi·ªÉm t·ªët/x·∫•u
- T√≠nh x√°c su·∫•t
- X√°c ƒë·ªãnh th·ªùi gian
""",
            "quiz": []
        }
    }
}


class LearningAssistantAI:
    """
    Tr·ª£ l√Ω h·ªçc QMDG
    - Cung c·∫•p b√†i h·ªçc theo tr√¨nh ƒë·ªô
    - Quiz ki·ªÉm tra ki·∫øn th·ª©c
    - Gi·∫£i ƒë√°p th·∫Øc m·∫Øc
    """
    
    def __init__(self):
        self.lessons = LESSONS
        self.progress = {}
    
    def get_lesson(self, level, lesson_num):
        """L·∫•y n·ªôi dung b√†i h·ªçc"""
        level_lessons = self.lessons.get(level, {})
        lesson = level_lessons.get(str(lesson_num))
        
        if lesson:
            return {
                "title": lesson["title"],
                "content": lesson["content"],
                "has_quiz": len(lesson.get("quiz", [])) > 0
            }
        return {"error": "Kh√¥ng t√¨m th·∫•y b√†i h·ªçc"}
    
    def get_quiz(self, level, lesson_num):
        """L·∫•y c√¢u h·ªèi quiz"""
        level_lessons = self.lessons.get(level, {})
        lesson = level_lessons.get(str(lesson_num))
        
        if lesson and lesson.get("quiz"):
            return lesson["quiz"]
        return []
    
    def check_answer(self, level, lesson_num, question_index, answer):
        """Ki·ªÉm tra c√¢u tr·∫£ l·ªùi"""
        quiz = self.get_quiz(level, lesson_num)
        if question_index < len(quiz):
            correct = quiz[question_index]["a"]
            is_correct = answer.strip() == correct.strip()
            return {
                "correct": is_correct,
                "your_answer": answer,
                "correct_answer": correct,
                "message": "‚úÖ Ch√≠nh x√°c!" if is_correct else f"‚ùå Sai. ƒê√°p √°n ƒë√∫ng: {correct}"
            }
        return {"error": "Kh√¥ng t√¨m th·∫•y c√¢u h·ªèi"}
    
    def get_curriculum(self):
        """L·∫•y ch∆∞∆°ng tr√¨nh h·ªçc"""
        output = []
        output.append("## üìö CH∆Ø∆†NG TR√åNH H·ªåC QMDG")
        output.append("")
        
        for level, lessons in self.lessons.items():
            level_name = {"basic": "C∆° b·∫£n", "intermediate": "Trung c·∫•p", "advanced": "N√¢ng cao"}.get(level, level)
            output.append(f"### {level_name.upper()}")
            for num, lesson in lessons.items():
                output.append(f"- B√†i {num}: {lesson['title']}")
            output.append("")
        
        return "\n".join(output)
    
    def explain_term(self, term):
        """Gi·∫£i th√≠ch thu·∫≠t ng·ªØ"""
        terms = {
            "khai m√¥n": "C·ª≠a M·ªü - T·ªët nh·∫•t trong B√°t M√¥n, th√≠ch h·ª£p cho m·ªçi vi·ªác kh·ªüi s·ª±",
            "sinh m√¥n": "C·ª≠a Sinh - T·ªët cho c·∫ßu t√†i, sinh s·∫£n, ph√°t tri·ªÉn",
            "h∆∞u m√¥n": "C·ª≠a Ngh·ªâ - T·ªët cho ngh·ªâ ng∆°i, y√™n ·ªïn, h·ªôi h·ªçp",
            "t·ª≠ m√¥n": "C·ª≠a T·ª≠ - X·∫•u nh·∫•t, kh√¥ng l√†m vi·ªác g√¨",
            "thi√™n t√¢m": "Sao Y d∆∞·ª£c - T·ªët cho vi·ªác ch·ªØa b·ªánh, gi√∫p ƒë·ª° ng∆∞·ªùi",
            "thi√™n ph·ª•": "Sao VƒÉn x∆∞∆°ng - T·ªët cho h·ªçc h√†nh, thi c·ª≠",
            "d·ª•ng th·∫ßn": "Y·∫øu t·ªë ƒë·∫°i di·ªán cho m·ª•c ti√™u ƒëang h·ªèi",
            "b·∫£n th√¢n": "ƒê·∫°i di·ªán cho ng∆∞·ªùi h·ªèi, th∆∞·ªùng l√† Can Ng√†y",
            "kh√¥ng vong": "Tr·∫°ng th√°i tr·ªëng r·ªóng, vi·ªác ch∆∞a th√†nh ho·∫∑c kh√¥ng th·ª±c",
            "d·ªãch m√£": "Sao di chuy·ªÉn, vi·ªác c√≥ bi·∫øn ƒë·ªông, di d·ªùi"
        }
        
        term_lower = term.lower()
        if term_lower in terms:
            return {"term": term, "explanation": terms[term_lower]}
        
        # T√¨m g·∫ßn ƒë√∫ng
        for t, exp in terms.items():
            if term_lower in t or t in term_lower:
                return {"term": t, "explanation": exp}
        
        return {"term": term, "explanation": "Kh√¥ng t√¨m th·∫•y. Th·ª≠ c√°c thu·∫≠t ng·ªØ: " + ", ".join(list(terms.keys())[:5])}
    
    def get_study_plan(self, days=30):
        """T·∫°o k·∫ø ho·∫°ch h·ªçc"""
        output = []
        output.append(f"## üìÖ K·∫æ HO·∫†CH H·ªåC QMDG - {days} NG√ÄY")
        output.append("")
        
        # Basic: 10 days
        output.append("### Tu·∫ßn 1-2: C∆† B·∫¢N")
        output.append("- Ng√†y 1-3: B√†i 1 - Gi·ªõi thi·ªáu QMDG")
        output.append("- Ng√†y 4-6: B√†i 2 - B√°t M√¥n")
        output.append("- Ng√†y 7-10: B√†i 3 - C·ª≠u Tinh")
        output.append("")
        
        # Intermediate: 10 days
        output.append("### Tu·∫ßn 3-4: TRUNG C·∫§P")
        output.append("- Ng√†y 11-15: D·ª•ng Th·∫ßn")
        output.append("- Ng√†y 16-20: B√°t Th·∫ßn")
        output.append("")
        
        # Advanced: 10 days
        output.append("### Tu·∫ßn 5-6: N√ÇNG CAO")
        output.append("- Ng√†y 21-25: Lu·∫≠n gi·∫£i t·ªïng h·ª£p")
        output.append("- Ng√†y 26-30: Th·ª±c h√†nh case study")
        
        return "\n".join(output)


# Singleton
_assistant = None

def get_learning_assistant():
    global _assistant
    if _assistant is None:
        _assistant = LearningAssistantAI()
    return _assistant


if __name__ == "__main__":
    assistant = get_learning_assistant()
    
    print(assistant.get_curriculum())
    print("\n" + "="*50 + "\n")
    
    lesson = assistant.get_lesson("basic", 1)
    print(lesson.get("content", ""))
